!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.minnow=e():t.minnow=e()}(window,function(){return function(t){var e={};function i(n){if(e[n])return e[n].exports;var s=e[n]={i:n,l:!1,exports:{}};return t[n].call(s.exports,s,s.exports,i),s.l=!0,s.exports}return i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)i.d(n,s,function(e){return t[e]}.bind(null,s));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";i.r(e);var n={};i.r(n),i.d(n,"BACKSPACE",function(){return s}),i.d(n,"TAB",function(){return r}),i.d(n,"ENTER",function(){return h}),i.d(n,"SHIFT",function(){return u}),i.d(n,"CTRL",function(){return a}),i.d(n,"ALT",function(){return o}),i.d(n,"PAUSE_BREAK",function(){return d}),i.d(n,"CAPSLOCK",function(){return c}),i.d(n,"ESCAPE",function(){return l}),i.d(n,"SPACE",function(){return f}),i.d(n,"PAGE_UP",function(){return _}),i.d(n,"PAGE_DOWN",function(){return p}),i.d(n,"END",function(){return g}),i.d(n,"HOME",function(){return y}),i.d(n,"LEFT_ARROW",function(){return w}),i.d(n,"UP_ARROW",function(){return m}),i.d(n,"RIGHT_ARROW",function(){return K}),i.d(n,"DOWN_ARROW",function(){return E}),i.d(n,"INSERT",function(){return D}),i.d(n,"DELETE",function(){return L}),i.d(n,"ZERO",function(){return M}),i.d(n,"ONE",function(){return S}),i.d(n,"TWO",function(){return T}),i.d(n,"THREE",function(){return A}),i.d(n,"FOUR",function(){return b}),i.d(n,"FIVE",function(){return C}),i.d(n,"SIX",function(){return R}),i.d(n,"SEVEN",function(){return v}),i.d(n,"EIGHT",function(){return P}),i.d(n,"NINE",function(){return U}),i.d(n,"A_KEY",function(){return N}),i.d(n,"B_KEY",function(){return B}),i.d(n,"C_KEY",function(){return O}),i.d(n,"D_KEY",function(){return F}),i.d(n,"E_KEY",function(){return x}),i.d(n,"F_KEY",function(){return I}),i.d(n,"G_KEY",function(){return Y}),i.d(n,"H_KEY",function(){return k}),i.d(n,"I_KEY",function(){return H}),i.d(n,"J_KEY",function(){return W}),i.d(n,"K_KEY",function(){return z}),i.d(n,"L_KEY",function(){return G}),i.d(n,"M_KEY",function(){return j}),i.d(n,"N_KEY",function(){return V}),i.d(n,"O_KEY",function(){return q}),i.d(n,"P_KEY",function(){return Q}),i.d(n,"Q_KEY",function(){return X}),i.d(n,"R_KEY",function(){return Z}),i.d(n,"S_KEY",function(){return $}),i.d(n,"T_KEY",function(){return J}),i.d(n,"U_KEY",function(){return tt}),i.d(n,"V_KEY",function(){return et}),i.d(n,"W_KEY",function(){return it}),i.d(n,"X_KEY",function(){return nt}),i.d(n,"Y_KEY",function(){return st}),i.d(n,"Z_KEY",function(){return rt}),i.d(n,"LEFT_WINDOW",function(){return ht}),i.d(n,"RIGHT_WINDOW",function(){return ut}),i.d(n,"SELECT",function(){return at}),i.d(n,"NUM_ZERO",function(){return ot}),i.d(n,"NUM_ONE",function(){return dt}),i.d(n,"NUM_TWO",function(){return ct}),i.d(n,"NUM_THREE",function(){return lt}),i.d(n,"NUM_FOUR",function(){return ft}),i.d(n,"NUM_FIVE",function(){return _t}),i.d(n,"NUM_SIX",function(){return pt}),i.d(n,"NUM_SEVEN",function(){return gt}),i.d(n,"NUM_EIGHT",function(){return yt}),i.d(n,"NUM_NINE",function(){return wt}),i.d(n,"MULTIPLY",function(){return mt}),i.d(n,"ADD",function(){return Kt}),i.d(n,"SUBTRACT",function(){return Et}),i.d(n,"DECIMAL_POINT",function(){return Dt}),i.d(n,"DIVIDE",function(){return Lt}),i.d(n,"F1",function(){return Mt}),i.d(n,"F2",function(){return St}),i.d(n,"F3",function(){return Tt}),i.d(n,"F4",function(){return At}),i.d(n,"F5",function(){return bt}),i.d(n,"F6",function(){return Ct}),i.d(n,"F7",function(){return Rt}),i.d(n,"F8",function(){return vt}),i.d(n,"F9",function(){return Pt}),i.d(n,"F10",function(){return Ut}),i.d(n,"F11",function(){return Nt}),i.d(n,"F12",function(){return Bt}),i.d(n,"NUM_LOCK",function(){return Ot}),i.d(n,"SCROLL_LOCK",function(){return Ft}),i.d(n,"SEMI_COLON",function(){return xt}),i.d(n,"EQUAL_SIGN",function(){return It}),i.d(n,"COMMA",function(){return Yt}),i.d(n,"DASH",function(){return kt}),i.d(n,"PERIOD",function(){return Ht}),i.d(n,"FORWARD_SLASH",function(){return Wt}),i.d(n,"GRAVE_ACCENT",function(){return zt}),i.d(n,"OPEN_BRACKET",function(){return Gt}),i.d(n,"BACK_SLASH",function(){return jt}),i.d(n,"CLOSE_BRACKET",function(){return Vt}),i.d(n,"SINGLE_QUOTE",function(){return qt}),i.d(n,"codesToKeyCodes",function(){return Qt});const s=8,r=9,h=13,u=16,a=17,o=18,d=19,c=20,l=27,f=32,_=33,p=34,g=35,y=36,w=37,m=38,K=39,E=40,D=45,L=46,M=48,S=49,T=50,A=51,b=52,C=53,R=54,v=55,P=56,U=57,N=65,B=66,O=67,F=68,x=69,I=70,Y=71,k=72,H=73,W=74,z=75,G=76,j=77,V=78,q=79,Q=80,X=81,Z=82,$=83,J=84,tt=85,et=86,it=87,nt=88,st=89,rt=90,ht=91,ut=92,at=93,ot=96,dt=97,ct=98,lt=99,ft=100,_t=101,pt=102,gt=103,yt=104,wt=105,mt=106,Kt=107,Et=109,Dt=110,Lt=111,Mt=112,St=113,Tt=114,At=115,bt=116,Ct=117,Rt=118,vt=119,Pt=120,Ut=121,Nt=122,Bt=123,Ot=144,Ft=145,xt=186,It=187,Yt=188,kt=189,Ht=190,Wt=191,zt=192,Gt=219,jt=220,Vt=221,qt=222,Qt={Backspace:s,Tab:r,Enter:h,ShiftLeft:u,ShiftRight:u,ControlLeft:a,ControlRight:a,AltLeft:o,AltRight:o,CapsLock:c,Escape:l,Space:f,PageUp:_,PageDown:p,End:g,Home:y,ArrowLeft:w,ArrowUp:m,ArrowRight:K,ArrowDown:E,Insert:D,Delete:L,Digit0:M,Digit1:S,Digit2:T,Digit3:A,Digit4:b,Digit5:C,Digit6:R,Digit7:v,Digit8:P,Digit9:U,KeyA:N,KeyB:B,KeyC:O,KeyD:F,KeyE:x,KeyF:I,KeyG:Y,KeyH:k,KeyI:H,KeyJ:W,KeyK:z,KeyL:G,KeyM:j,KeyN:V,KeyO:q,KeyP:Q,KeyQ:X,KeyR:Z,KeyS:$,KeyT:J,KeyU:tt,KeyV:et,KeyW:it,KeyX:nt,KeyY:st,KeyZ:rt,Select:at,Numpad0:ot,Numpad1:dt,Numpad2:ct,Numpad3:lt,Numpad4:ft,Numpad5:_t,Numpad6:pt,Numpad7:gt,Numpad8:yt,Numpad9:wt,NumpadMultiply:mt,NumpadAdd:Kt,NumpadSubtract:Et,NumpadDecimal:Dt,NumpadDivide:Lt,F1:Mt,F2:St,F3:Tt,F4:At,F5:bt,F6:Ct,F7:Rt,F8:vt,F9:Pt,F10:Ut,F11:Nt,F12:Bt,NumLock:Ot,ScrollLock:Ft,Semicolon:xt,Equal:It,NumpadEqual:It,Comma:Yt,NumpadComma:Yt,Period:Ht,Slash:Wt,Backquote:zt,BracketLeft:Gt,Backslash:jt,BracketRight:Vt,Quote:qt,Minus:kt,NumpadEnter:h},Xt=1,Zt=2;var $t=class{constructor(){this.conainerId="minnow-container",this.container=null,this.width=320,this.height=180,this.scale=3,this.maxScale=-1,this.minScale=1,this.scaleMode=Xt,this.horizontalScaleCushion=0,this.verticalScaleCushion=0,this.rescaleOnWindowResize=!0,this.hideCursor=!1,this.tileData=null,this.mapData=null,this.onScaleChange=null,this.canvas=null,this._context=null,this._imageData=null,this._screenData=null,this._palette=null,this._generatedPalette=null,this._isLittleEndian=!0}init(){this.container=document.getElementById(this.conainerId),this.canvas=document.createElement("canvas"),this.canvas.setAttribute("id","game-device"),this.canvas.setAttribute("width",this.width),this.canvas.setAttribute("height",this.height),this._setScale(),this.rescaleOnWindowResize&&this.scaleMode!==Xt&&(window.onresize=(()=>{this._setScale(),this._setCanvasStyle()})),this._setCanvasStyle(),this.container.appendChild(this.canvas),this._context=this.canvas.getContext("2d",{alpha:!1}),this._context.imageSmoothingEnabled=!1,this._screenData=new Uint8ClampedArray(this.width*this.height),this._imageData=this._context.getImageData(0,0,this.width,this.height);const t=new ArrayBuffer(4),e=new Uint8ClampedArray(t);new Uint32Array(t)[0]=168496141,10===e[0]&&11===e[1]&&12===e[2]&&13===e[3]&&(this._isLittleEndian=!1),this._palette||(this._palette=[[0,0,0],[0,0,0],[255,255,255],[255,0,0],[0,255,0],[0,0,255]]),this._buildPalette()}_setScale(){if(this.scaleMode===Zt){const t=window.innerWidth-this.horizontalScaleCushion,e=window.innerHeight-this.verticalScaleCushion,i=Math.floor(t/this.width),n=Math.floor(e/this.height);this.scale=i<n?i:n,this.scale<this.minScale&&(this.scale=this.minScale),this.maxScale>0&&this.scale>this.maxScale&&(this.scale=this.maxScale)}this.onScaleChange&&this.onScaleChange(this.scale)}_setCanvasStyle(){let t="";t+=`width: ${this.width*this.scale}px;`,t+=`height: ${this.height*this.scale}px;`,this.container.setAttribute("style",t);let e="";e+="transform-origin: 50% 0%;",e+=`transform: scale(${this.scale});`,e+="image-rendering: -webkit-optimize-contrast;",e+="image-rendering: -moz-crisp-edges;",e+="image-rendering: crisp-edges;",e+="image-rendering: pixelated;",this.hideCursor&&(e+="cursor: none"),this.canvas.setAttribute("style",e)}setPalette(t){this._palette=t,this._buildPalette()}setPaletteColorAtIndex(t,e){this._palette[e]=t,this._buildPalette()}_buildPalette(){this._generatedPalette=new Uint32Array(this._palette.length);let t=null;if(this._isLittleEndian)for(let e=0;e<this._palette.length;e+=1)t=this._palette[e],this._generatedPalette[e]=255<<24|t[2]<<16|t[1]<<8|t[0];else for(let e=0;e<this._palette.length;e+=1)t=this._palette[e],this._generatedPalette[e]=t[0]<<24|t[1]<<16|t[2]<<8|255}setPixel(t,e,i){i&&(t<0||t>=this.width||e<0||e>=this.height||(this._screenData[e*this.width+t]=i))}setPixelUnsafe(t,e,i){i&&(this._screenData[e*this.width+t]=i)}getPixel(t,e){return this._screenData[e*this.width+t]}clear(t){t?this._screenData.fill(t):this._screenData.fill(0)}drawLine(t,e,i,n,s){if(t!==i||e!==n)if(t!==i)if(e!==n)Math.abs(n-e)<Math.abs(i-t)?t>i?this._drawLineLow(i,n,t,e,s):this._drawLineLow(t,e,i,n,s):e>n?this._drawLineHigh(i,n,t,e,s):this._drawLineHigh(t,e,i,n,s);else{if(e<0||e>=this.height)return;let n=t<i?t:i,r=t<i?i:t;if(r<0)return;if(n>=this.width)return;n<0&&(n=0),r>=this.width&&(r=this.width-1);for(let t=n;t<=r;t+=1)this.setPixelUnsafe(t,e,s)}else{if(t<0||t>=this.width)return;let i=e<n?e:n,r=e<n?n:e;if(r<0)return;if(i>=this.height)return;i<0&&(i=0),r>=this.height&&(r=this.height-1);for(let e=i;e<=r;e+=1)this.setPixelUnsafe(t,e,s)}else this.setPixel(t,i,s)}_drawLineLow(t,e,i,n,s){const r=i-t;let h=n-e,u=1;h<0&&(u=-1,h=-h);let a=2*h-r,o=e;for(let e=t;e<=i;e+=1)this.setPixel(e,o,s),a>0&&(o+=u,a-=2*r),a+=2*h}_drawLineHigh(t,e,i,n,s){let r=i-t;const h=n-e;let u=1;r<0&&(u=-1,r=-r);let a=2*r-h,o=t;for(let t=e;t<=n;t+=1)this.setPixel(o,t,s),a>0&&(o+=u,a-=2*h),a+=2*r}drawRect(t,e,i,n,s){if(t>=this.width)return;if(e>=this.height)return;let r=t,h=e,u=t+i-1,a=e+n-1;if(!(u<0||a<0)){r<0&&(r=0),h<0&&(h=0),u>=this.width&&(u=this.width-1),a>=this.height&&(a=this.height-1);for(let t=h;t<=a;t+=1)for(let e=r;e<=u;e+=1)this.setPixelUnsafe(e,t,s)}}drawRectBorder(t,e,i,n,s){if(t>=this.width)return;if(e>=this.height)return;if(1===i&&1===n)return void this.setPixel(t,e,s);const r=t+i-1,h=e+n-1;r<0||h<0||(1!==i?1!==n?(this.drawLine(t,e,t,h,s),this.drawLine(t,h,r,h,s),this.drawLine(r,h,r,e,s),this.drawLine(r,e,t,e,s)):this.drawLine(t,e,r,e,s):this.drawLine(t,e,t,h,s))}drawCircle(t,e,i,n){if(i<=0)return;if(1===i)return this.drawCircleBorder(t,e,i,n),void this.setPixel(t,e,n);let s=0,r=i;this.drawLine(t-i,e,t+i,e,n);let h=3-2*i;for(;r>=s;)s+=1,h=h>0?h+4*(s-(r-=1))+10:h+4*s+6,this._drawCircleFilledOctants(t,e,s,r,n)}drawCircleBorder(t,e,i,n){if(i<=0)return;let s=0,r=i;this._drawCircleBorderOctants(t,e,s,r,n);let h=3-2*i;for(;r>=s;)s+=1,h=h>0?h+4*(s-(r-=1))+10:h+4*s+6,this._drawCircleBorderOctants(t,e,s,r,n)}_drawCircleFilledOctants(t,e,i,n,s){this.drawLine(t-i,e+n,t+i,e+n,s),this.drawLine(t-i,e-n,t+i,e-n,s),this.drawLine(t-n,e+i,t+n,e+i,s),this.drawLine(t-n,e-i,t+n,e-i,s)}_drawCircleBorderOctants(t,e,i,n,s){this.setPixel(t+i,e+n,s),this.setPixel(t-i,e+n,s),this.setPixel(t+i,e-n,s),this.setPixel(t-i,e-n,s),this.setPixel(t+n,e+i,s),this.setPixel(t-n,e+i,s),this.setPixel(t+n,e-i,s),this.setPixel(t-n,e-i,s)}drawTile(t,e,i){if(!t)return;if(e>=this.width)return;if(i>=this.height)return;const{tileSize:n}=this.tileData;if(e+n<0)return;if(i+n<0)return;const s=(t-1)*n*n;for(let t=0;t<n;t+=1)for(let r=0;r<n;r+=1){const h=this.tileData.data[s+t*n+r];this.setPixel(e+r,i+t,h)}}drawMap(t,e,i,n,s,r,h=0,u=0){const a=this.mapData.tileMaps[h],o=a.layers[u],{tileSize:d}=this.tileData;let c=t+i,l=e+n;c>=a.width&&(c=a.width-1),l>=a.height&&(l=a.height-1);for(let i=e;i<=l;i+=1)for(let e=t;e<=c;e+=1){const t=o[i*a.width+e];t&&this.drawTile(t,s+e*d,r+i*d)}}drawScreen(){const t=new ArrayBuffer(this._imageData.data.length),e=new Uint8ClampedArray(t),i=new Uint32Array(t);let n=0,s=0;for(let t=0;t<this.height;t+=1)for(let e=0;e<this.width;e+=1)s=this.height-t-1,n=this._screenData[s*this.width+e],i[t*this.width+e]=this._generatedPalette[n];this._imageData.data.set(e),this._context.putImageData(this._imageData,0,0)}};const Jt=0,te=1,ee=2,ie=3,ne=4,se=5,re=6,he=7,ue=8,ae=9,oe=10,de=11,ce=12,le=13,fe=14,_e=15,pe=16;var ge=class{constructor(){this.canvas=null,this.canvasScale=1,this.screenWidth=1,this.screenHeight=1,this.mouse={},this.mouse.isOffScreen=!0,this.mouse.position={x:-1,y:-1},this.mouse.left={pressed:!1,down:!1,up:!1},this.mouse.right={pressed:!1,down:!1,up:!1},this._keysRaw=new Uint8ClampedArray(256),this._currentKeys=new Uint8ClampedArray(256),this._lastKeys=new Uint8ClampedArray(256),this._buttonsToKeys=new Uint8ClampedArray(32),this._buttonsToKeys[Jt]=w,this._buttonsToKeys[te]=K,this._buttonsToKeys[ee]=m,this._buttonsToKeys[ie]=E,this._buttonsToKeys[ne]=rt,this._buttonsToKeys[se]=nt,this._buttonsToKeys[re]=N,this._buttonsToKeys[he]=$,this._buttonsToKeys[ae]=X,this._buttonsToKeys[oe]=it,this._buttonsToKeys[ue]=Q,this._buttonsToKeys[de]=w,this._buttonsToKeys[ce]=K,this._buttonsToKeys[le]=m,this._buttonsToKeys[fe]=E,this._buttonsToKeys[_e]=nt,this._buttonsToKeys[pe]=rt,this._currentButtons=new Uint8ClampedArray(32),this._lastButtons=new Uint8ClampedArray(32),this._currentMouseLeft=!1,this._lastMouseLeft=!1,this._forceMouseLeftDown=!1,this._currentMouseRight=!1,this._lastMouseRight=!1,this._forceMouseRightDown=!1}init(){window.addEventListener("keydown",this._keyDown.bind(this),!1),window.addEventListener("keyup",this._keyUp.bind(this),!1),this.canvas&&(this.canvas.oncontextmenu=(t=>{t.preventDefault()}),this.canvas.addEventListener("mouseenter",this._mouseEnter.bind(this),!1),this.canvas.addEventListener("mousemove",this._mouseMove.bind(this),!1),this.canvas.addEventListener("mousedown",this._mouseDown.bind(this),!1),this.canvas.addEventListener("mouseup",this._mouseUp.bind(this),!1),this.canvas.addEventListener("mouseleave",this._mouseLeave.bind(this),!1))}_keyDown(t){t.code?this._keysRaw[Qt[t.code]]=1:this._keysRaw[t.keyCode]=1}_keyUp(t){t.code?this._keysRaw[Qt[t.code]]=0:this._keysRaw[t.keyCode]=0}_mouseEnter(){this.mouse.isOffScreen=!1,this._currentMouseLeft=!1,this._currentMouseRight=!1}_mouseMove(t){const e=this.canvas.getBoundingClientRect();this.mouse.position={x:Math.floor((t.clientX-e.left)/this.canvasScale),y:this.screenHeight-Math.floor((t.clientY-e.top)/this.canvasScale)-1}}_mouseDown(t){0===t.button?(this._currentMouseLeft=!0,this._forceMouseLeftDown=!0):2===t.button&&(this._currentMouseRight=!0,this._forceMouseRightDown=!0)}_mouseUp(t){0===t.button?this._currentMouseLeft=!1:2===t.button&&(this._currentMouseRight=!1)}_mouseLeave(){this.mouse.isOffScreen=!0}pollInput(){for(let t=0;t<256;t+=1)this._lastKeys[t]=this._currentKeys[t],this._currentKeys[t]=this._keysRaw[t];this._updateButtons(),this.mouse.left.pressed=!!this._forceMouseLeftDown||this._currentMouseLeft,this.mouse.left.down=!!this._forceMouseLeftDown||this._currentMouseLeft&&!this._lastMouseLeft,this.mouse.left.up=!this._currentMouseLeft&&this._lastMouseLeft,this.mouse.right.pressed=!!this._forceMouseRightDown||this._currentMouseRight,this.mouse.right.down=!!this._forceMouseRightDown||this._currentMouseRight&&!this._lastMouseRight,this.mouse.right.up=!this._currentMouseRight&&this._lastMouseRight,this._forceMouseLeftDown=!1,this._forceMouseRightDown=!1,this._lastMouseLeft=this._currentMouseLeft,this._lastMouseRight=this._currentMouseRight}getKeyPressed(t){return!(t<0||t>=256)&&this._currentKeys[t]>0}getKeyDown(t){if(t<0||t>=256)return!1;const e=this._currentKeys[t]>0,i=this._lastKeys[t]>0;return e&&!i}getKeyUp(t){if(t<0||t>=256)return!1;const e=this._currentKeys[t]>0,i=this._lastKeys[t]>0;return!e&&i}getButtonPressed(t){return this.getKeyPressed(this._buttonsToKeys[t])}getButtonDown(t){return this.getKeyDown(this._buttonsToKeys[t])}getButtonUp(t){return this.getKeyUp(this._buttonsToKeys[t])}_updateButtons(){this._updateButton("left",Jt),this._updateButton("right",te),this._updateButton("up",ee),this._updateButton("down",ie),this._updateButton("action1",ne),this._updateButton("action2",se),this._updateButton("action3",re),this._updateButton("action4",he),this._updateButton("leftTrigger",ae),this._updateButton("rightTrigger",oe),this._updateButton("pause",ue),this._updateButton("menuLeft",de),this._updateButton("menuRight",ce),this._updateButton("menuUp",le),this._updateButton("menuDown",fe),this._updateButton("menuConfirm",_e),this._updateButton("menuBack",pe)}_updateButton(t,e){const i=this._buttonsToKeys[e],n=this.getKeyPressed(i),s=this.getKeyDown(i),r=this.getKeyUp(i);this[t]={pressed:n,down:s,up:r}}};var ye=class{constructor(){this.tileSize=16,this.tilesets=[],this.data=null}init(){let t=0;for(let e=0;e<this.tilesets.length;e+=1){const i=this.tilesets[e];t+=i.width*i.height}this.data=new Uint8ClampedArray(t*this.tileSize*this.tileSize);let e=0,i=1;for(let t=0;t<this.tilesets.length;t+=1){const n=this.tilesets[t];n.firstGid=i;const{data:s}=n;if("array"===n.format)for(let t=0;t<s.length;t+=1)this.data[e+t]=parseInt(s[t],10);else if("run"===n.format){let t=0,i=0;for(;t<s.length;){const n=s[t],r=parseInt(s[t+1],10);for(let t=0;t<n;t+=1)this.data[e+i]=r,i+=1;t+=2}}i+=n.width*n.height,e+=n.width*n.height*this.tileSize*this.tileSize}}addTileset(t){this.tilesets.push(t)}getGid(t,e,i=0){if(t<0||e<0)return-1;const n=this.tilesets[i],{width:s,height:r,firstGid:h}=n;return t>=s||e>=r?-1:e*s+t+h}};const we=0,me=1,Ke=2,Ee=3,De=4,Le=5,Me=6,Se=7,Te=8;var Ae=class{constructor(t){this.name="",this.width=0,this.height=0,this.layers=new Array(9),t&&(this.name=t.name,this.width=t.width,this.height=t.height,t.main&&(this.layers[we]=this._getTypedArrayFromDataLayer(t.main)),t.bg1&&(this.layers[me]=this._getTypedArrayFromDataLayer(t.bg1)),t.bg2&&(this.layers[Ke]=this._getTypedArrayFromDataLayer(t.bg2)),t.bg3&&(this.layers[Ee]=this._getTypedArrayFromDataLayer(t.bg3)),t.fg1&&(this.layers[De]=this._getTypedArrayFromDataLayer(t.fg1)),t.fg2&&(this.layers[Le]=this._getTypedArrayFromDataLayer(t.fg2)),t.fg3&&(this.layers[Me]=this._getTypedArrayFromDataLayer(t.fg3)),t.col&&(this.layers[Se]=this._getTypedArrayFromDataLayer(t.col)),t.meta&&(this.layers[Te]=this._getTypedArrayFromDataLayer(t.meta)))}_getTypedArrayFromDataLayer(t){const e=new Uint16Array(this.width*this.height);for(let i=0;i<t.length;i+=1)e[i]=t[i];return e}getTile(t,e,i=0){return this.layers[i][e*this.width+t]}setTile(t,e,i,n=0){this.layers[n][i*this.width+e]=t}};var be=class{constructor(){this.tileMaps=[]}addTileMap(t){return this.tileMaps.push(new Ae(t)),this.tileMaps.length-1}getTile(t,e,i=0,n=0){return this.tileMaps[i].getTile(t,e,n)}setTile(t,e,i,n=0,s=0){this.tileMaps[n].setTile(t,e,i,s)}};var Ce=class{constructor(){this.containerId="minnow-container",this.onInit=null,this.onUpdate=null,this.screen=new $t,this.input=new ge,this.tileData=new ye,this.mapData=new be,this._update=this._update.bind(this)}begin(){this.onInit&&this.onInit(),this.screen.init(),this.screen.onScaleChange=(t=>{this.input.canvasScale=t}),this.input.canvas=this.screen.canvas,this.input.canvasScale=this.screen.scale,this.input.screenWidth=this.screen.width,this.input.screenHeight=this.screen.height,this.input.init(),this.tileData.init(),this.screen.tileData=this.tileData,this.screen.mapData=this.mapData,requestAnimationFrame(this._update)}_update(){this.input.pollInput(),this.onUpdate&&this.onUpdate(),this.screen.drawScreen(),requestAnimationFrame(this._update)}};i.d(e,"Keys",function(){return Re}),i.d(e,"default",function(){return Ce}),i.d(e,"Engine",function(){return Ce}),i.d(e,"Screen",function(){return $t}),i.d(e,"Input",function(){return ge}),i.d(e,"TileData",function(){return ye}),i.d(e,"MapData",function(){return be}),i.d(e,"TileMap",function(){return Ae});const Re=n}])});